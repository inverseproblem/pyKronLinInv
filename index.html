

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>kronlininv’s documentation &mdash; KronLinInv 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> KronLinInv
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">kronlininv</span></code>’s documentation</a><ul>
<li><a class="reference internal" href="#user-guide">User guide</a><ul>
<li><a class="reference internal" href="#theoretical-background">Theoretical background</a></li>
<li><a class="reference internal" href="#usage-examples">Usage examples</a><ul>
<li><a class="reference internal" href="#d-example">2D example</a></li>
<li><a class="reference internal" href="#id1">3D example</a><ul>
<li><a class="reference internal" href="#module-kronlininv">API <code class="docutils literal notranslate"><span class="pre">kronlininv</span></code>, list of functions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">KronLinInv</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li><code class="docutils literal notranslate"><span class="pre">kronlininv</span></code>’s documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kronlininv-s-documentation">
<h1><code class="docutils literal notranslate"><span class="pre">kronlininv</span></code>’s documentation<a class="headerlink" href="#kronlininv-s-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="user-guide">
<h2>User guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>This document describes the Python version of the code KronLinInv.</p>
<p>If you use this code for research or else, please cite the related paper:</p>
</div></blockquote>
<p>Andrea Zunino, Klaus Mosegaard (2018), <strong>An efficient method to solve large linearizable inverse problems under Gaussian and separability assumptions</strong>, <em>Computers &amp; Geosciences</em>. ISSN 0098-3004, &lt;<a class="reference external" href="https://doi.org/10.1016/j.cageo.2018.09.005">https://doi.org/10.1016/j.cageo.2018.09.005</a>&gt;.</p>
<p>See the above mentioned paper for a detailed description.</p>
<div class="section" id="theoretical-background">
<h3>Theoretical background<a class="headerlink" href="#theoretical-background" title="Permalink to this headline">¶</a></h3>
<p>KronLinInv solves the <em>linear inverse problem</em> with Gaussian uncertainties
represented by the following objective function</p>
<div class="math notranslate nohighlight">
\[S( \mathbf{m}) = \frac{1}{2} ( \mathbf{G} \mathbf{m} - \mathbf{d}_{\sf{obs}} )^{\sf{T}} \mathbf{C}^{-1}_{\rm{D}} ( \mathbf{G} \mathbf{m} - \mathbf{d}_{\sf{obs}} ) + \frac{1}{2} ( \mathbf{m} - \mathbf{m}_{\sf{prior}} )^{\sf{T}} \mathbf{C}^{-1}_{\rm{M}} ( \mathbf{m} - \mathbf{m}_{\sf{prior}} )\]</div>
<p>under the following separability conditions (for a 3-way decomposition):</p>
<div class="math notranslate nohighlight">
\[\mathbf{C}_{\rm{M}} = \mathbf{C}_{\rm{M}}^{\rm{x}} \otimes
\mathbf{C}_{\rm{M}}^{\rm{y}} \otimes \mathbf{C}_{\rm{M}}^{\rm{z}}
, \quad
\mathbf{C}_{\rm{D}} = \mathbf{C}_{\rm{D}}^{\rm{x}} \otimes
\mathbf{C}_{\rm{D}}^{\rm{y}} \otimes \mathbf{C}_{\rm{D}}^{\rm{z}}
\quad \textrm{ and } \quad
\mathbf{G} = \mathbf{G}^{\rm{x}} \otimes \mathbf{G}^{\rm{y}} \otimes \mathbf{G}^{\rm{z}} \, .\]</div>
<p>From the above, the posterior covariance matrix is given by</p>
<div class="math notranslate nohighlight">
\[\mathbf{\widetilde{C}}_{\rm{M}} =  \left( \mathbf{G}^{\sf{T}} \,
\mathbf{C}^{-1}_{\rm{D}} \, \mathbf{G} + \mathbf{C}^{-1}_{\rm{M}} \right)^{-1}\]</div>
<p>and the center of posterior gaussian is</p>
<div class="math notranslate nohighlight">
\[\mathbf{\widetilde{m}}
= \mathbf{m}_{\rm{prior}}+ \mathbf{\widetilde{C}}_{\rm{M}} \, \mathbf{G}^{\sf{T}} \, \mathbf{C}^{-1}_{\rm{D}} \left(\mathbf{d}_{\rm{obs}} - \mathbf{G} \mathbf{m}_{\rm{prior}} \right) \, .\]</div>
<p>KronLinInv solves the inverse problem in an efficient manner, with a very low memory imprint, suitable for large problems where many model parameters and observations are involved.</p>
<p>The paper describes how to obtain the solution to the above problem as shown hereafter. First the following matrices are computed</p>
<div class="math notranslate nohighlight">
\[\mathbf{U}_1 \mathbf{\Lambda}_1  \mathbf{U}_1^{-1}
= \mathbf{C}_{\rm{M}}^{\rm{x}} (\mathbf{G}^{\rm{x}})^{\sf{T}}
(\mathbf{C}_{\rm{D}}^{\rm{x}})^{-1} \mathbf{G}^{\rm{x}}\]</div>
<div class="math notranslate nohighlight">
\[\mathbf{U}_2 \mathbf{\Lambda}_2  \mathbf{U}_2^{-1}
=  \mathbf{C}_{\rm{M}}^{\rm{y}} (\mathbf{G}^{\rm{y}})^{\sf{T}}
(\mathbf{C}_{\rm{D}}^{\rm{y}})^{-1} \mathbf{G}^{\rm{y}}\]</div>
<div class="math notranslate nohighlight">
\[\mathbf{U}_3 \mathbf{\Lambda}_3  \mathbf{U}_3^{-1}
= \mathbf{C}_{\rm{M}}^{\rm{z}} (\mathbf{G}^{\rm{z}})^{\sf{T}}
(\mathbf{C}_{\rm{D}}^{\rm{z}})^{-1} \mathbf{G}^{\rm{z}}  \, .\]</div>
<p>The posterior covariance is then expressed as</p>
<div class="math notranslate nohighlight">
\[\mathbf{\widetilde{C}}_{\rm{M}} =
\left(
\mathbf{U}_1 \otimes \mathbf{U}_2 \otimes \mathbf{U}_3
\right)
\big(
\mathbf{I} + \mathbf{\Lambda}_1 \! \otimes \! \mathbf{\Lambda}_2 \! \otimes \! \mathbf{\Lambda}_3
\big)^{-1}
\big(
\mathbf{U}_1^{-1}  \mathbf{C}_{\rm{M}}^{\rm{x}} \otimes
\mathbf{U}_2^{-1} \mathbf{C}_{\rm{M}}^{\rm{y}} \otimes
\mathbf{U}_3^{-1} \mathbf{C}_{\rm{M}}^{\rm{z}}
\big) \, .\]</div>
<p>and the posterior mean model as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbf{\widetilde{m}} =
\mathbf{m}_{\rm{prior}} +
\Big[ \!
\left(
\mathbf{U}_1 \otimes \mathbf{U}_2 \otimes \mathbf{U}_3
\right)
\big(
\mathbf{I} + \mathbf{\Lambda}_1\!  \otimes \! \mathbf{\Lambda}_2 \!  \otimes\!  \mathbf{\Lambda}_3
\big)^{-1} \\
\times \Big(
\left( \mathbf{U}_1^{-1}  \mathbf{C}_{\rm{M}}^{\rm{x}} (\mathbf{G}^{\rm{x}})^{\sf{T}} (\mathbf{C}_{\rm{D}}^{\rm{x}})^{-1} \right) \!    \otimes
\left( \mathbf{U}_2^{-1} \mathbf{C}_{\rm{M}}^{\rm{y}}  (\mathbf{G}^{\rm{y}})^{\sf{T}} (\mathbf{C}_{\rm{D}}^{\rm{y}})^{-1}  \right)   \!
\\
\otimes  \left( \mathbf{U}_3^{-1} \mathbf{C}_{\rm{M}}^{\rm{z}} (\mathbf{G}^{\rm{z}})^{\sf{T}} (\mathbf{C}_{\rm{D}}^{\rm{z}})^{-1} \right)
\Big)
\Big] \\
\times \Big( \mathbf{d}_{\rm{obs}} - \big( \mathbf{G}^{\rm{x}} \otimes \mathbf{G}^{\rm{y}} \otimes \mathbf{G}^{\rm{z}} \big) \, \mathbf{m}_{\rm{prior}} \Big) \, .\end{split}\]</div>
<p>These last two formulae are those used by the KronLinInv algorithm.</p>
<p>Several function are exported by the module KronLinInv:</p>
<ul class="simple">
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">calcfactors()</span></code>: Computes the factors necessary to solve the inverse problem</li>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">posteriormean()</span></code>: Computes the posterior mean model using the previously computed “factors” with <code class="xref py py-func docutils literal notranslate"><span class="pre">calcfactors()</span></code>.</li>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">blockpostcov()</span></code>: Computes a block (or all) of the posterior covariance using the previously computed “factors” with <code class="xref py py-func docutils literal notranslate"><span class="pre">calcfactors()</span></code>.</li>
<li><code class="xref py py-func docutils literal notranslate"><span class="pre">bandpostcov()</span></code>: NOT YET IMPLEMENTED! Computes a band of the posterior covariance the previously computed “factors” with <code class="xref py py-func docutils literal notranslate"><span class="pre">calcfactors()</span></code>.</li>
</ul>
</div>
<div class="section" id="usage-examples">
<h3>Usage examples<a class="headerlink" href="#usage-examples" title="Permalink to this headline">¶</a></h3>
<p>The input needed is represented by the set of three covariance matrices of the model parameters, the three covariances of the observed data, the three forward model operators, the observed data (a vector) and the prior model (a vector).
_The <strong>first</strong> thing to compute is always the set of “factors” using the function <code class="xref py py-func docutils literal notranslate"><span class="pre">calcfactors()</span></code>.
Finally, the posterior mean (see <code class="xref py py-func docutils literal notranslate"><span class="pre">posteriormean()</span></code>) and/or covariance (or part of it) (see <code class="xref py py-func docutils literal notranslate"><span class="pre">blockpostcov()</span></code>) can be computed.</p>
<div class="section" id="d-example">
<h4>2D example<a class="headerlink" href="#d-example" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Example::</dt>
<dd># import the module
import kronlininv</dd>
</dl>
</div>
<div class="section" id="id1">
<h4>3D example<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="section" id="module-kronlininv">
<span id="api-kronlininv-list-of-functions"></span><h5>API <code class="docutils literal notranslate"><span class="pre">kronlininv</span></code>, list of functions<a class="headerlink" href="#module-kronlininv" title="Permalink to this headline">¶</a></h5>
<dl class="attribute">
<dt id="kronlininv.blockpostcov">
<code class="descclassname">kronlininv.</code><code class="descname">blockpostcov</code><a class="reference internal" href="_modules/kronlininv/kronlininv_core.html#blockpostcov"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kronlininv.blockpostcov" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute a block of the posterior covariance defined by the min/max indices astart/aend (rows), bstart/bend (columns).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>factkli</strong> – (named tuple): a set of arrays computed with the function calcfactors()</li>
<li><strong>astart</strong><strong>,</strong><strong>aend</strong> (<em>integers</em>) – the first and last row of the posterior covariance to be computed</li>
<li><strong>bstart</strong><strong>,</strong><strong>bend</strong> (<em>integers</em>) – the first and last column of the posterior covariance to be computed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">a block of the posterior covariance</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="kronlininv.calcfactors">
<code class="descclassname">kronlininv.</code><code class="descname">calcfactors</code><span class="sig-paren">(</span><em>G1</em>, <em>G2</em>, <em>G3</em>, <em>Cm1</em>, <em>Cm2</em>, <em>Cm3</em>, <em>Cd1</em>, <em>Cd2</em>, <em>Cd3</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/kronlininv/kronlininv_core.html#calcfactors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kronlininv.calcfactors" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div>Compute the factors required to solve the inverse problem.
These factors are the ones to be stored to compute the posterior covariance or mean.</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>G1</strong><strong>,</strong><strong>G2</strong><strong>,</strong><strong>G3</strong> (<em>ndarrays</em>) – the three forward model matrices</li>
<li><strong>Cm1</strong><strong>,</strong><strong>Cm2</strong><strong>,</strong><strong>Cm3</strong> (<em>ndarrays</em>) – the three covariance matrices related to the model parameters</li>
<li><strong>Cd1</strong><strong>,</strong><strong>Cd2</strong><strong>,</strong><strong>Cd3</strong> (<em>ndarrays</em>) – the three covariance matrices related to the observed data</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">a set of arrays required to subsequently calculate the posterior mean or covariance</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">named tuple</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="kronlininv.posteriormean">
<code class="descclassname">kronlininv.</code><code class="descname">posteriormean</code><a class="reference internal" href="_modules/kronlininv/kronlininv_core.html#posteriormean"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kronlininv.posteriormean" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the posterior mean model.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>factkli</strong> (<em>named tuple</em>) – a set of arrays computed with the function calcfactors()</li>
<li><strong>G1</strong><strong>,</strong><strong>G2</strong><strong>,</strong><strong>G3</strong> (<em>ndarrays</em>) – the three forward model matrices</li>
<li><strong>mprior</strong> (<em>ndarray</em><em>, </em><em>1D</em>) – the prior model</li>
<li><strong>dobs</strong> (<em>ndarray</em><em>, </em><em>1D</em>) – the observed data</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the posterior mean model</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray, 1D</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="toctree-wrapper compound">
</div>
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h3>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Andrea Zunino

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>